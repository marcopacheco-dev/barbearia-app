<div class="container" [ngClass]="{ 'dark-mode': modoEscuroAtivo }">
  <h3 class="titulo-agenda mt-4 mb-3 text-center dark-text">
    Agenda Semanal - ðŸ’ˆ Guile BarberShop ðŸ’ˆ
  </h3>

  <div class="d-flex flex-column align-items-center gap-3 mb-3 text-center">
    <!-- NavegaÃ§Ã£o entre semanas -->
    <div *ngIf="semanasDoMes.length > 0" class="d-flex justify-content-center align-items-center gap-2 flex-wrap">
      <button class="btn btn-outline-primary" (click)="semanaAnterior()" aria-label="Semana anterior">
        â¬… Semana Anterior
      </button>
      <button class="btn btn-outline-primary" (click)="proximaSemana()" aria-label="Semana seguinte">
        Semana Seguinte âž¡
      </button>
    </div>

    <!-- BotÃµes de meses -->
    <div class="btn-group flex-wrap">
      <button *ngFor="let mes of meses; let i = index"
              class="btn"
              [class.btn-primary]="mesAtual === i"
              [class.btn-outline-primary]="mesAtual !== i"
              (click)="selecionarMes(i)">
        {{ mes }}
      </button>
    </div>

    <!-- BotÃµes de anos -->
    <div class="btn-group flex-wrap">
      <button *ngFor="let ano of anos"
              class="btn"
              [class.btn-primary]="anoAtual === ano"
              [class.btn-outline-primary]="anoAtual !== ano"
              (click)="selecionarAno(ano)">
        {{ ano }}
      </button>
    </div>
  </div>

  <!-- InformaÃ§Ãµes da semana -->
  <div class="info-semana text-center mb-4">
    <h3 class="text-xl font-bold text-blue-700">
      Semana {{ indiceSemanaDoMes + 1 }} de {{ semanasDoMes.length }}
    </h3>
    <p class="text-gray-600">
      {{ intervaloSemanaAtual }}
    </p>
  </div>

  <!-- Tabela da agenda -->
  <div class="tabela-wrapper" style="overflow-x: auto;">
    <div class="tabela-container">
      <table mat-table [dataSource]="horariosDisponiveis" class="mat-elevation-z8 full-width-table" multiTemplateDataRows>

        <!-- Coluna de horÃ¡rios -->
        <ng-container matColumnDef="horario">
          <th mat-header-cell *matHeaderCellDef sticky class="horario-header dark-bg dark-text">HorÃ¡rio</th>
          <td mat-cell *matCellDef="let horario" sticky class="horario-cell dark-text">
            <strong>{{ horario }}</strong>
          </td>
        </ng-container>

        <!-- Colunas para os dias da semana -->
        <ng-container *ngFor="let dia of diasSemana; let i = index" [matColumnDef]="'dia' + i">
          <th mat-header-cell *matHeaderCellDef class="dark-bg dark-text">
            {{ dia | date: 'EEE dd/MM' : undefined : 'pt-BR' }}
          </th>
          <td mat-cell *matCellDef="let horario" class="dark-text">
            <ng-container *ngIf="agendamentosSemanaAtual[horario]?.[dia.toDateString()] as agendamento">
              <div class="agendamento-cell d-flex align-items-center justify-content-between">
                <span class="cliente-nome">{{ agendamento.nomeCliente }}</span>
                <button mat-icon-button
                        color="warn"
                        aria-label="Cancelar agendamento"
                        matTooltip="Cancelar agendamento"
                        matTooltipPosition="above"
                        (click)="cancelarAgendamento(dia, horario)">
                  <mat-icon>cancel</mat-icon>
                </button>
              </div>
            </ng-container>
            <ng-container *ngIf="!agendamentosSemanaAtual[horario]?.[dia.toDateString()]">
              <span class="disponivel-status">DisponÃ­vel</span>
            </ng-container>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="linha-final"></tr>
      </table>

      <!-- PaginaÃ§Ã£o por semana -->
      <nav *ngIf="semanasDoMes.length > 1" class="mt-3">
        <ul class="pagination justify-content-center">
          <li class="page-item" [class.disabled]="indiceSemanaDoMes === 0">
            <button class="page-link" (click)="semanaAnterior()" aria-label="Semana anterior">Anterior</button>
          </li>

          <li class="page-item"
              *ngFor="let semana of semanasDoMes; let i = index"
              [class.active]="i === indiceSemanaDoMes">
            <button class="page-link" (click)="irParaSemana(i)">
              {{ i + 1 }}
            </button>
          </li>

          <li class="page-item" [class.disabled]="indiceSemanaDoMes === semanasDoMes.length - 1">
            <button class="page-link" (click)="proximaSemana()" aria-label="Semana seguinte">PrÃ³xima</button>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>
